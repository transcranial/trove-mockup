"use strict";angular.module("mockupApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/dashboard",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).otherwise({redirectTo:"/"})}]);var app=angular.module("mockupApp");app.controller("MainCtrl",["$scope","$location",function(a,b){a.test="pass",a.login=function(){b.path("/dashboard")}}]);var app=angular.module("mockupApp");app.controller("DashboardCtrl",["$scope",function(a){a.colors=["#5C97BF","#F4D03F","#1BBC9B","#D24D57","#9B59B6","#F89406"],a.colorLuminance=function(a,b){a=String(a).replace(/[^0-9a-f]/gi,""),a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),b=b||0;var c,d,e="#";for(d=0;3>d;d++)c=parseInt(a.substr(2*d,2),16),c=Math.round(Math.min(Math.max(0,c+c*b),255)).toString(16),e+=("00"+c).substr(c.length);return e};var b=function(a,b){for(var c=[],d=0;a>d;d++)c.push(Math.round(Math.random()*b));return c};a.data={name:"Leon Chen",residency_progress:6,number_studies_by_modality:[{label:"XR",weekly_numbers:b(10,100),subcategories:["Abdomen","Chest","Bone","Other"],subcategories_numbers:b(4,250),total:0},{label:"CT",weekly_numbers:b(10,20),subcategories:["Head","Chest","Abdomen/Pelvis","Other"],subcategories_numbers:b(4,50),total:0},{label:"MR",weekly_numbers:b(10,10),subcategories:["Brain","Other"],subcategories_numbers:b(2,50),total:0}],weekly_dates:["7-Jun-14","14-Jun-14","21-Jun-14","28-Jun-14","5-Jul-14","12-Jul-14","19-Jul-14","26-Jul-14","2-Aug-14","9-Aug-14"],number_studies_total:0,points:0,badges:42};for(var c=0,d=0;3>d;d++)a.data.number_studies_by_modality[d].total=a.data.number_studies_by_modality[d].weekly_numbers.reduce(function(a,b){return a+b}),a.data.number_studies_total=a.data.number_studies_total+a.data.number_studies_by_modality[d].total,c=a.data.number_studies_by_modality[d].total-a.data.number_studies_by_modality[d].subcategories_numbers.slice(0,a.data.number_studies_by_modality[d].subcategories.length-1).reduce(function(a,b){return a+b}),0>c?a.data.number_studies_by_modality[d].subcategories_numbers[a.data.number_studies_by_modality[d].subcategories.length-2]=a.data.number_studies_by_modality[d].subcategories_numbers[a.data.number_studies_by_modality[d].subcategories.length-2]+c:a.data.number_studies_by_modality[d].subcategories_numbers[a.data.number_studies_by_modality[d].subcategories.length-1]=c;a.data.points=a.data.number_studies_by_modality[0].total+20*a.data.number_studies_by_modality[1].total+30*a.data.number_studies_by_modality[2].total,a.modality_selected_index=-1}]),app.directive("summaryChart",["$window",function(a){return{restrict:"E",link:function(b,c){function d(){for(var a=[],c=0,d=0;d<b.data.weekly_dates.length;d++)if(-1==b.modality_selected_index){c=0;for(var e=0;e<b.data.number_studies_by_modality.length;e++)c+=b.data.number_studies_by_modality[e].weekly_numbers[d];a.push({weekly_date:s(b.data.weekly_dates[d]),weekly_number:c})}else a.push({weekly_date:s(b.data.weekly_dates[d]),weekly_number:b.data.number_studies_by_modality[b.modality_selected_index].weekly_numbers[d]});C.select("path.line").remove(),y=d3.scale.linear().domain([0,d3.max(a,function(a){return a.weekly_number})]).nice().range([r,0]),A.scale(y),C.select(".y.axis").transition().duration(300).call(A);var f=C.append("path").datum(a).attr("class","line").attr("d",B).style("stroke",function(){return-1==b.modality_selected_index?"#2C3E50":j[b.modality_selected_index]}),g=f.node().getTotalLength();f.attr("stroke-dasharray",g+" "+g).attr("stroke-dashoffset",g).transition().duration(2e3).ease("linear").attr("stroke-dashoffset",0)}var e=a.innerHeight/3,f=a.innerHeight/3,g=60,h=f/2,i=h+20,j=b.colors,k=b.data.number_studies_by_modality,l=d3.select(c[0]).append("svg").attr("width",e+2*g).attr("height",f+2*g).append("g").attr("transform","translate("+(h+g)+","+(h+g)+")"),m=d3.svg.arc().outerRadius(h).innerRadius(1),n=d3.layout.pie().sort(null).value(function(a){return a.total}),o=l.selectAll(".arc").data(n(k)).enter().append("g").attr("class","arc").on("mouseover",function(){var a=d3.svg.arc().outerRadius(h+10);d3.select(this).select("path").transition().ease("elastic").duration(600).attr("d",a)}).on("mouseout",function(){d3.select(this).select("path").transition().ease("elastic").duration(600).attr("d",m)});o.append("path").attr("d",m).style("fill",function(a,b){return j[b]}).on("mouseover",function(a,c){b.modality_selected_index=c,b.$apply(),d()}).on("mouseout",function(){b.modality_selected_index=-1,b.$apply()}),o.append("text").attr("transform",function(a){var b=m.centroid(a),c=b[0],d=b[1],e=Math.sqrt(c*c+d*d);return"translate("+c/e*i+","+d/e*i+")"}).attr("dy",".35em").attr("class","pie-graph-label").attr("text-anchor",function(a){return(a.endAngle+a.startAngle)/2>Math.PI?"end":"start"}).text(function(a,b){return k[b].label}).style("fill",function(a,b){return j[b]});for(var p={top:50,right:20,bottom:30,left:50},q=a.innerWidth-document.getElementById("dashboard-sidebar").clientWidth-2*h-2*g-p.left-p.right-50,r=a.innerHeight/3-p.top-p.bottom,s=d3.time.format("%d-%b-%y").parse,t=[],u=0,v=0;v<b.data.weekly_dates.length;v++)if(-1==b.modality_selected_index){u=0;for(var w=0;w<b.data.number_studies_by_modality.length;w++)u+=b.data.number_studies_by_modality[w].weekly_numbers[v];t.push({weekly_date:s(b.data.weekly_dates[v]),weekly_number:u})}else t.push({weekly_date:s(b.data.weekly_dates[v]),weekly_number:b.data.number_studies_by_modality[b.modality_selected_index].weekly_numbers[v]});var x=d3.time.scale().domain(d3.extent(t,function(a){return a.weekly_date})).range([0,q]),y=d3.scale.linear().domain([0,d3.max(t,function(a){return a.weekly_number})]).nice().range([r,0]),z=d3.svg.axis().scale(x).orient("bottom").tickValues(t.map(function(a){return a.weekly_date})).tickFormat(d3.time.format("%b %d, %Y")),A=d3.svg.axis().scale(y).orient("left").ticks(5),B=d3.svg.line().interpolate("linear").x(function(a){return x(a.weekly_date)}).y(function(a){return y(a.weekly_number)}),C=d3.select(c[0]).append("svg").attr("width",q+p.left+p.right).attr("height",f+p.top+p.bottom).append("g").attr("transform","translate("+p.left+","+p.top+")");C.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(z).selectAll("text").style("text-anchor","end").attr("dx","-0.8em").attr("dy","0.15em").attr("transform",function(){return"rotate(-65)"}),C.append("g").attr("class","y axis").call(A).append("text").style("text-anchor","end").text("# Read").attr("transform","translate(0,-12)"),d()}}}]);